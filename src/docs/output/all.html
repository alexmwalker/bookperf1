<h1>What Is a CDN and How Does It Work?</h1>
<h3>Bruno Škvorc</h3>

<p>CDN - you keep seeing the acronym. Maybe in URLs, maybe on landing pages, but it never quite clicked - what are Content Delivery Networks, what do they <strong>do</strong> exactly?</p>

<p>We'll explain in this overview article, and demonstrate on two popular ones in followup posts.</p>

<p><img src="https://www.sitepoint.com/wp-content/uploads/2017/10/1509315406network-1989146_640.png" alt="Network" /></p>

<h2 id="cdnbasics">CDN Basics</h2>

<p>A CDN is a network of computers that delivers content.</p>

<p>More specifically, it's a bunch of servers geographically positioned between the origin server of some web content, and the user requesting it, all with the purpose of delivering the content faster by reducing latency. This is their <em>primary purpose</em>.</p>

<p>These geographically closer servers, also called PoPs or Points of Presence, also cache the cacheable content which removes a lot of the load from the origin server. There are different types of CDNs offering different kinds of services, and they can have differing <a href="http://www.doc.ic.ac.uk/~mz4615/"><em>network topology</em></a>: scattered CDNs aim to have as many servers scattered around the world as possible. Akamai is one such CDN. Consolidated CDNs have fewer points, but bigger ones built for network performance, throughput, and DDoS resistance. </p>

<p>[author_more]</p>

<h2 id="typesofcdns">Types of CDNs</h2>

<p>We said that their primary purpose was to reduce latency and speed up rendering. But in the modern world of 2MB images and 500kb JavaScript libraries that take 3 minutes to boot up on websites, this latency matters little. But there are other purposes to CDNs, too, which evolved over time.</p>

<h3 id="contentorientedcdns">Content-oriented CDNs</h3>

<p>Initially, CDNs were just for static content (JS, CSS, HTML). You had to push content to them as you created/uploaded it (they didn't know they needed to update their cache with your content, not even as someone requested it).</p>

<p>Then, they added <a href="https://knowledgelayer.softlayer.com/faq/how-does-origin-pull-work">origin pulling</a>, making things more automatic - this meant that a user requested the CDN's URL, and then the CDN requested the origin website's URL automatically, caching what ever it got back. Additionally, availability became an important factor. Many CDNs now cache a website's "last alive" state so that if the origin goes down, the CDNed content is still accessible to users, creating the illusion of stability until things return to normal.</p>

<p>Additionally, modern CDNs often offer auto-optimization layers which will automagically resize images and save them for future use based on the image size requested. This means what if your site has a 2MB header image and someone requests it on a 300px wide screen, the CDN will make a copy that's 30kb in size and 300px wide and serve that in the future to all mobile users, automatically making the site faster.</p>

<h3 id="securityorientedcdns">Security-oriented CDNs</h3>

<p>The final layer of practicality added to CDNs was DDoS and bot protection. CDNs like Incapsula specialize in this.</p>

<p>As the CDN is the outermost layer of a website's infrastructure and the first recipient of traffic, it can detect DDoS attacks early and block them with special DDoS protection servers called <em>scrubbers</em> without them ever reaching the origin server and crashing it.</p>

<p>Additionally, by using knowledge crowdsourced from its many clients, a CDN can <em>learn</em> about suspicious IPs, spammers, botters, even <em>types</em> of crawlers and their behavior. For example, a scraper that works on site A will, once identified, stop working on site B as well if that site is protected by the same CDN, because the traffic filter will recognize a pattern it's seen before.</p>

<p><img src="https://www.sitepoint.com/wp-content/uploads/2017/10/1509315571german-shepherd-166972_640.jpg" alt="German Shepard Guarding" /></p>

<p>What's more, while CDNs do allow their customers to upload custom certificates, they also offer their own. This has two benefits:</p>

<ol>
<li>When a big vulnerability in the certificates appears, the CDNs usually quickly respond because they have the most to lose (all their customers). Hence, a fix is usually in place before most people even know about the security hole.</li>

<li>Connections are faster because if many websites use the same CDN, then you've already established a valid connection and mutual trust with the CDN via its SSL certificate, and this process does not have to be repeated for every site that uses that CDN's certificate. This doesn't impact an individual website as much as it does <em>the entire web</em>.</li>
</ol>

<h2 id="biggestplayers">Biggest Players</h2>

<p>Some of the biggest players in the CDN space are companies like Akamai, AWS Cloudfront, Cloudinary, Incapsula, MaxCDN, Fastly, and others.</p>

<p>Rather than <a href="https://www.geckoandfly.com/10077/maxcdn-amazon-cloudfront-cloudflare-cachefly-and-edgecast-cdn-comparison/">compare them in full</a>, we'll list the categories in which each can be a champion:</p>

<h3 id="scrapingandddosprotection">Scraping and DDoS Protection</h3>

<p>While fine in every other way too, Incapsula is unbeatable in scraping and DDoS protection. With an extensive database of not only offending proxy IP addresses but also mouse and browsing patterns of bots and scrapers, Incapsula stops most automated attacks dead in their tracks.</p>

<p><strong>Choose if:</strong> you're a web shop and don't want your competitors to scrap your catalog</p>

<h3 id="speedandglobalreach">Speed and Global Reach</h3>

<p>Akamai, the CDN that even Facebook uses, has a proven track record of global availability. Their scattered model of network topology and availability in even the poorer parts of the world (something other CDNs lack) make content served with Akamai smooth to load even in low-connectivity areas. A close second is AWS Cloudfront from Amazon.</p>

<p><strong>Choose if:</strong> you're aiming for global reach, from China to US, from Finland to Antarctica.</p>

<h3 id="affordability">Affordability</h3>

<p>Amazon Cloudfront is the cheapest of the paid plans (we don't count free plans as those often lack important features) and has the arguably largest reach after Akamai, which isn't exactly cheap (a scattered topology is expensive to maintain).</p>

<p><strong>Choose if:</strong> price is an issue.</p>

<h3 id="hotlinking">Hotlinking</h3>

<p>Hotlinking is when someone selects "Copy image address" on an image hosted on your website, and includes it in their own directly, with the original URL intact. This is usually sloppy and lazy work on the side of content thieves, but can lead to big expenses if the copycat succeeds in sharing their site on large-impact social media website like Facebook or Reddit, and your server suffers for it. MaxCDN and KeyCDN both offer very good hotlinking protection.</p>

<p><strong>Choose if:</strong> you've got a gallery, travel blog, or any other image-rich site which is at risk of hotlinking.</p>

<h3 id="other">Other</h3>

<p>We encourage you to go out and investigate on your own. There are countless posts comparing the CDNs one to the other, and each plan of each CDN differs in offered options to the next one. It's extremely difficult to cover them all, and the landscape constantly changes.</p>

<h2 id="implementationprocess">Implementation Process</h2>

<p>Implementing a CDN typically entails changing some DNS records in the control panel of the registrar (the company renting you your domain name). This results in all traffic hitting the CDN first, which in turn hits your website. Since it all happens behind the scenes (through IPs), the process is transparent to the user.</p>

<p><img src="https://www.sitepoint.com/wp-content/uploads/2017/10/1509315728a1443ce742af309856b66e2d1777bd9d-coding-programming.jpg" alt="Front end vs back end" /></p>

<p>Sometimes, sites will add a special subdomain to their main domain on which to host images, JavaScript, CSS, and other static content. If you open the Network tab of a browser's dev console or just pay attention to the status bar of your browser while a site like Facebook is loading, you'll notice a lot of URLs with <code>cdn</code> in them - that's the site in question requesting only <em>some</em> of its content from CDNs. </p>

<p>Why not request all content through CDNs? Because static content is usually big - 2MB images, 500kb of JS, etc. This is worth serving quickly, because a) it doesn't change often and can be cached for a long time and b) removes a big, big load from the main server of the app, which can be dynamic.</p>

<h2 id="conclusion">Conclusion</h2>

<p>In this article, you learned what a CDN was and how it works. You found out about the different types of CDNs and their potential scope of work, as well as the biggest players in the field.</p>

<p>In two followup articles we'll introduce Cloudinary and Cloudflare, and in our major Performance-Month-Project we'll actually implement one of them into our real world app so you can see it in action on a live example. Stay tuned!</p>
<!DOCTYPE html><html><head><title>Performance | Front-end Performance Site</title><link rel="stylesheet" href="css/style.css" type="text/css"></head><body><div class="container"><h1>Performance</h1><p><em>This article is part of a series created in partnership with
<a href="https://www.siteground.com/go/article-sp">SiteGround</a>. Thank you for
supporting the partners who make SitePoint possible.</em></p>
<p><strong>The question <em>&quot;which browsers should my website/app support?&quot;</em> is
often raised by clients and developers. The simple answer is a list of
the top N mainstream applications. But has that policy become
irrelevant?</strong></p>
<h2 id="what-are-the-most-used-browsers-">What are the Most-used Browsers?</h2>
<p>The top ten desktop browsers according to
<a href="http://gs.statcounter.com/">StatCounter</a> for May 2017 were:</p>
<ol>
<li>Chrome --- 59.37% market share</li>
<li>Firefox --- 12.76%</li>
<li>Safari --- 10.55%</li>
<li>IE --- 8.32%</li>
<li>Edge --- 3.42%</li>
<li>Opera --- 1.99%</li>
<li>Android (tablet) --- 1.24%</li>
<li>Yandex Browser --- 0.48%</li>
<li>UC Browser --- 0.41%</li>
<li>Coc Coc --- 0.33%</li>
</ol>
<p><a href="http://gs.statcounter.com/#desktop+mobile-comparison-ww-monthly-201705-201705-bar">Mobile now accounts for 54.25% of all web
use</a>
so we also need to examine the top ten phone browsers:</p>
<ol>
<li>Chrome --- 49.23%</li>
<li>Safari --- 17.73%</li>
<li>UC Browser --- 15.89%</li>
<li>Samsung Internet --- 6.58%</li>
<li>Opera --- 5.03%</li>
<li>Android --- 3.75%</li>
<li>IEMobile --- 0.68%</li>
<li>BlackBerry --- 0.26%</li>
<li>Edge --- 0.15%</li>
<li>Nokia --- 0.12%</li>
</ol>
<p>The worldwide statistics don&#39;t tell the whole story:</p>
<ul>
<li>Patterns vary significantly across regions. For example, Yandex is
the second most-used Russian browser (12.7% share). Sogou is the
third most-used browser in China (6.5%). Opera Mobile/Mini has a 28%
share in Africa.</li>
<li>New browser releases appear regularly. Chrome, Firefox and Opera
receive updates every six weeks; it would be impractical to check
versions going back more than a few months.</li>
<li>The same browsers can work differently across devices and operating
systems. Chrome is available for various editions of Windows, macOS,
Linux, Android, iOS and ChromeOS, but it&#39;s not the same application
everywhere.</li>
<li>There is an exceedingly long tail of old and new, weird and
wonderful browsers on a range of devices including games consoles,
ebook readers and smart TVs.</li>
<li>Your site&#39;s analytics will never match global statistics.</li>
</ul>
<h2 id="are-browsers-so-different-">Are Browsers So Different?</h2>
<p>Despite the organic variety of applications, all browsers have the same
goal: <em>to render web pages</em>. They achieve this with a rendering engine
and there is some cross-pollination:</p>
<ol>
<li>Webkit is used in Safari on macOS and iOS.</li>
<li>Blink is a fork of Webkit now used in Chrome, Opera, Vivaldi and
Brave.</li>
<li>Gecko is used in Firefox.</li>
<li>Trident is used in Internet Explorer.</li>
<li>EdgeHTML is an update of Trident used in Edge.</li>
</ol>
<p>The majority of browsers use one of these engines. They&#39;re different
projects with diverse teams but the companies (mostly) collaborate via
the W3C to ensure new technologies are adopted by everyone in the same
way. Browsers are closer than they&#39;ve ever been, and modern smartphone
applications are a match for their desktop counterparts. However, no two
browsers render in quite the same way. The majority of differences are
subtle, but they become more pronounced as you move toward cutting-edge
technologies. A particular feature may be fully implemented in one
browser, partially implemented in another, and non-existent elsewhere.</p>
<h2 id="can-my-site-work-in-every-browser-">Can My Site Work in Every Browser?</h2>
<p>Yes. Techniques such as progressive enhancement (PE) establish a
baseline (perhaps HTML only) then enhance with CSS and JavaScript when
support is available. Recent browsers get a modern layout, animated
effects and interactive widgets. Ancient browsers may get unstyled HTML
only. Everything else gets something in between. PE works well for
content sites and apps with basic form-based functionality. It becomes
less practical as you move toward applications with rich custom
interfaces. Your new collaborative video editing app is unlikely to work
in the decade-old IE7. It may not work on a small screen device over a
3G network. Perhaps it&#39;s possible to provide an alternative interface
but the result could be a separate, clunky application few would want to
use. The cost would be prohibitive given the size of the legacy browser
user base.</p>
<h2 id="site-owner-recommendations">Site Owner Recommendations</h2>
<p>Site owners should appreciate the following fundamentals and constraints
of the web. <strong>The web is not print!</strong> Your site/app will not look
identical everywhere. Each device has a different OS, browser, screen
size, capabilities etc. <strong>Functionality can differ</strong> Your site can work
for everyone but experiences and facilities will vary. Even something as
basic as a date entry field can has a diverse range of possibilities
but, ideally, the core application will remain operable. <strong>Assess your
project</strong> Be realistic. Is this a content site, a simple app, a
desktop-like application, a fast-action game etc. Establish a base level
of browser compatibility. For example, it must work on most two-year-old
browsers with a screen width of 600 pixels over a fast Wi-Fi connection.
<strong>Assess your audience</strong> Don&#39;t rely on global browser statistics. Who
are the primary users? Are they IT novices or highly technical? Is it
individuals, small companies or government organisations? Do they sit at
a desk or are they on the move? No application applies to everyone ---
concentrate on the core users first. Examine the analytics of your
existing system where possible but appreciate the underlying data. If
your app doesn&#39;t work in Opera Mini, you&#39;re unlikely to have Opera Mini
users. Have you blocked a significant proportion of your market?
<strong>Change happens</strong> It&#39;s amazing that a web page coded twenty years ago
works today. It won&#39;t necessarily be pretty or usable but browsers
remain backward compatible. <em>(Mostly. The <code>&lt;blink&gt;</code> tag can stay dead!)</em>
However, technology evolves. The more complex your site or application,
the more likely it will require ongoing maintenance.</p>
<h2 id="web-developer-recommendations">Web Developer Recommendations</h2>
<p>With a little care it&#39;s possible to support a huge variety of browsers.
<strong>Embrace the web!</strong> The web is a device-agnostic platform. Content and
simpler interfaces can work everywhere: a modern laptop, a feature
phone, a games console, IE6, etc. Learn the basics of progressive
enhancement. Even if you choose not to adopt it for your full
application, there will be pockets of functionality where it becomes
invaluable. <strong>Adopt Defensive Development Techniques</strong> Consider the
problem before reaching for the nearest pre-written module, library or
framework. Understand the consequences of that technology before you
start. Frameworks should provide a browser support list because they
have been tested in limited number of applications. Learn about browser
limits and quirks. For example, if you&#39;re considering an SVG chart, be
aware that it can look odd in IE9 to 11 and fail in IE8 and below. That
doesn&#39;t mean it&#39;s a binary choice of rejecting SVGs or abandoning IE
support. There are always compromises which do not incur significant
development. For example:</p>
<ul>
<li>accept SVG rendering is weird but it remains usable</li>
<li>only show a table of data in IE, or</li>
<li>provide an SVG download which IE users can open elsewhere.</li>
</ul>
<p><strong>Test early and test often</strong> You cannot possibly test every device, but
developing for a single browser is futile. Continually test your project
in a variety of applications. Leaving testing to the end will have
catastrophic consequences. It&#39;s easy for us to blame tools and browser
inadequacies, but the majority of issues can be rectified during the
development process if they&#39;re spotted early. That&#39;s not to say
everything must work identically in every browser every time. Feature
regressions are inevitable. For example:</p>
<ul>
<li>Progressive Web Apps do not work offline on iPhones and iPads ---
but online operation is fine.</li>
<li>CSS Grid is not supported in IE --- but float, flexbox or full-width
block fallbacks should be acceptable.</li>
<li>The desktop edition of Firefox does not show a calendar for date
fields --- but users can still enter one.</li>
</ul>
<p>Install a selection of browsers on your development PC. Mac and Linux
users can obtain Microsoft Edge and IE testing tools at
<a href="https://developer.microsoft.com/en-us/microsoft-edge/">developer.microsoft.com/microsoft-edge/</a>.
It&#39;s more difficult for Windows and Linux users to test Safari; online
test services such as <a href="https://www.browserstack.com/">BrowserStack</a> are
the easiest option. Modern browsers have excellent mobile emulation
facilities, but use a few real devices to appreciate touch control and
performance on slower hardware and networks. <strong>Use HTTPS on your end</strong>
The web is gradually making HTTPS the preferred protocol, and this trend
is going to continue. Google Chrome is even starting to indicate that
non-HTTPS sites as insecure, which is a good reason for you to configure
your site to use HTTPS. Our web hosting partner,
<a href="https://www.siteground.com/go/article-sp">SiteGround</a>, for example,
made it easy for their clients to make the move to HTTPS. To do that,
they automated the installation of Let’s Encrypt SSL certificates for
all new WordPress accounts, and for existing ones, they made the switch
to HTTPS possible with just a click.</p>
<h2 id="you-haven-t-answered-the-question-">You Haven&#39;t Answered the Question!</h2>
<p>The question <em>&quot;which browsers should you support?&quot;</em> has become too
restrictive. Presume your answer was just &quot;Chrome&quot;:</p>
<ul>
<li><em>which devices and OS is it running on?</em></li>
<li><em>what range of screen sizes will be supported?</em></li>
<li><em>which version are you referring to? The latest? Chrome 10 and
above?</em></li>
<li><em>what happens when a new version of Chrome is released?</em></li>
<li><em>what will happen in other browsers when Chrome effectively becomes
your application&#39;s runtime?</em></li>
</ul>
<p>Providing a browser support list has become impractical for
client-facing projects. Perhaps the best answer is: <em>&quot;we&#39;ll develop your
project according to presumed demographics then test as in many devices,
OSes, browsers, and versions as possible according to budget and time
constraints&quot;</em>. Even then, you&#39;ll miss that aging Blackberry the CEO
insists on using. Develop for the web --- <em>not browsers</em>.</p>
</div></body></html><h1>Are Your WordPress Themes Flexible or Fast?</h1>
<h3>Maria Antonietta Perna</h3>

<p><em>This article is part of a series created in partnership with <a href="https://www.sitepoint.com/siteground-recommended-65-off" rel="nofollow">SiteGround</a>. Thank you for supporting the partners who make SitePoint possible.</em></p>

<p><strong>If you've developed WordPress themes for mass distribution, you might have come across the problem of finding the perfect balance between building performant themes and building feature-rich, media-heavy products for your customers.</strong></p>

<p>Let's look closer into what the tension might be all about and how you can find ways to compromise between creating fast-loading themes and giving users the flexibility and easy customization options they love and expect.</p>

<h2 id="areflexibilityandperformanceatoddswhencodingwordpressthemes">Are Flexibility and Performance at Odds When Coding WordPress Themes?</h2>

<p>I will start by saying that my discussion is not going to be about performance in relation to an entire WordPress website, which might include a number of different factors like finding a <a href="https://www.siteground.com/wordpress-hosting.htm">great hosting provider</a>, implementing caching mechanisms, leveraging both back-end and front-end techniques, etc.</p>

<p>Also, the topic is not about the performance of WordPress themes you code from scratch either for your own use or for a specific client. In these particular cases you tailor your themes to the specific needs of yourself or your individual client, which should make performance optimizations easy to accommodate.</p>

<p>Rather, my focus will be on WordPress themes you code for the general public, to be distributed on WordPress.org or an online marketplace. The scenario is one where you, as the theme developer, have no control over how your theme is going to be used and customized.</p>

<p>But why could coding for performance clash with coding themes for the public?</p>

<p>On the whole, performance requires you to:</p>

<ul>
  <li>stick to simple designs</li>
  <li>include a limited number of features into your themes (more features are likely to require more processing power and resources, all of which impacts on theme performance)</li>
  <li>add the minimum number of page templates for a theme to function (fewer templates require fewer resources, which is good for performance)</li>
  <li>perform as few database queries as possible (querying the database takes time)</li>
  <li>limit the number and size of images and other media, which are notoriously heavy files</li>
  <li>minimize the number of HTTP requests (each round trip to the server and back takes some time with obvious negative consequences on performance).</li>
</ul>

<p>On the other hand, a considerable number of your theme's users are likely more entrepreneurial than tech minded. Therefore, what they might be looking for is a product they can turn into pretty much anything without so much as one line of code, with lots of functionality out of the box, breathtaking photo and video assets, super delightful parallax and other animation effects, and such like.</p>

<p>To give theme users all the flexibility they would like could come with some performance costs. But let's go into a few specific points that illustrate how this can happen and how you can find some middle ground for a successful outcome.</p>

<h3 id="themesareforappearancepluginsforfunctionality">Themes are for appearance, plugins for functionality</h3>

<p>Although a number of reputable WordPress experts have been throwing some well-argued <a href="https://wptavern.com/envato-continues-to-rake-in-the-cash-from-wordpress-themes-packaged-as-complete-website-solutions">criticisms against the so-called <em>kitchen sink themes</em></a> --- that is, those multipurpose themes that can become anything to anybody by offering any functionality under the sun --- the demand for them is still going strong.</p>

<p>Themes that give users the ability to easily add social media buttons, SEO features, contact forms, price tables, etc., while attracting a lot of attention from buyers, don't come without some serious drawbacks.</p>

<p>In particular, this kind of WordPress theme comes tightly coupled with plugins specifically built for it, or even integrated directly into the theme. This practice is widely frowned upon for the following reasons:</p>

<ul>
  <li>Some of the plugins that come bundled with a theme can have vulnerabilities that put theme users at risk. If the theme doesn't come with specific plugins installed it's less open to such risks
  </li>
  <li>A super important drawback of tight integration between themes and plugins is what <a href="https://www.engagewp.com/why-i-no-longer-use-themeforest/">Ren Ventura identifies as <em>theme lock</em></a>. Here's his explanation of this problem:

  <blockquote>
    Theme lock occurs when a WordPress user cannot change his or her theme without gutting most of the site’s functionality. Once the theme is deactivated, it deactivates things like shortcodes and custom post types that were registered by the theme. Without these features that the user has heavily incorporated into the site, things fall apart.
  </blockquote>

  As a consequence, when you change theme, a lot of the stuff you thought it was part of your website content disappears with the old theme. For instance, if your theme offered the ability to add testimonials to your website, once you change theme all the content related to your testimonials will be gone. Not nice.
  </li>
  <li>And of course, bloat and hence performace costs.  Let's say you don't need a testimonials section on your website. Yet, all the code that makes that functionality work in the theme is still there: it takes up space on your server, which ultimately costs money.
  </li>
</ul>

<p>A great maxim the Theme Review Team (i.e., the volunteers who review themes submitted on the WordPress.org themes repo) rightly enforces is: <strong>keep functionality separate from appearance. Plugins deal with functionality, themes with appearance.</strong> Getting rid of all the complication will improve theme performance and at the same time make it easier for users to install and configure WordPress themes.</p>

<h3 id="yourusersdontneedtonsofthemeoptions">Your users don't need tons of theme options (but they might not know this)</h3>

<p>Until not long ago, WordPress themes included rather complicated theme option pages to enable users to make all sorts of modifications with a button click.</p>

<p>These days, thanks to a momentous <a href="https://make.wordpress.org/themes/2015/04/22/details-on-the-new-theme-settings-customizer-guideline/">decision taken by the Theme Review Team on WordPress.org</a> in 2015, most themes offer theme options using the <a href="https://developer.wordpress.org/themes/customize-api/">WordPress Customizer</a>, which makes possible live previewing the changes as they're being made by users.</p>

<p>Unfortunately, the kitchen sink mentality that ruled the old theme option pages has started to migrate to the Customizer, which you can now see as also starting to get filled up with all sorts of settings.</p>

<p>Although non technical customers love theme options to make changes to their themes, sometimes too many options available bring more problems than they seemingly solve:</p>

<ul>
  <li>Too many options can paralyze users who are not too familiar with core principles of website design.</li>
  <li>It can take more time than expected to set up and configure a theme.</li>
  <li>It's easy to make mistakes like choosing the wrong colors, making text unreadable, etc.</li>
  <li>Users might add too many fonts to their themes, thereby spoiling the design and slowing down the website.</li>
  <li>More options means adding more functionality to the theme, thereby impacting on its performance.</li>
</ul>

<p>Although your customers might not accept this at first, you are the theme designer, therefore you should be the one who is best placed to make the important design decisions for your theme.</p>

<p>A well-calibrated number of theme options should be sufficient to let your customers make some targeted and carefully predefined (by you) modifications to personalize the theme and make it their own.</p>

<h3 id="implementsmartgraphicsoptimizationtechniques">Implement smart graphics optimization techniques</h3>

<p>Images are likely to put the heaviest weight on theme performance compared to template files, scripts and styles. Just run any theme through <a href="https://tools.pingdom.com/">Pingdom's Speed Test tool</a> to verify this.</p>

<p>However, a generous use of full-screen, bold images is hardly surprising. Images add huge aesthetic value to themes and customers are drawn to a theme largely on the basis of its visual impact.</p>

<p>Although it's hard to resist the power of great graphics, the guidelines below can help you code faster themes without necessarily sacrificing aesthetics (too much):</p>

<ul>
  <li>Using as few images as possible is always a good guiding principle.</li>
  <li>Take advantage of CSS <a href="https://www.sitepoint.com/close-up-css-mix-blend-mode-property/">blend modes</a>, <a href="https://www.sitepoint.com/css-filter-effects-blur-grayscale-brightness-and-more-in-css/">filters</a>, and semi-transparent overlays on low-resolution images to mask pixelation and enhance their visual appearance. You can also try to experiment with CSS <a href="https://codepen.io/helmsmith/pen/xbBEWy">blend modes</a> and <a href="https://codepen.io/commander-clifford/pen/PZJYBo">filters on HTML elements and text</a> rather than images to create stunning visual effects wherever possible.</li>
  <li>Make sure the images are of the <a href="https://www.sitepoint.com/what-is-the-right-image-format-for-your-website/">appropriate format</a> and optimized for web.</li>
  <li>Where appropriate, use <a href="https://www.sitepoint.com/css-sprites-sass-compass/">CSS sprites</a> to combine your images into a larger image and therefore reduce HTTP requests.</li>
  <li><p>Try implementing <a href="https://www.sitepoint.com/five-techniques-lazy-load-images-website-performance/">lazy loading for images</a>. Doing so will achieve faster page load, and if users don't scroll to the location of the <code>&lt;img&gt;</code> tag, the image won't need to be downloaded at all. To lazy load images in WordPress you can choose from a number of good plugins, such as <a href="https://wordpress.org/plugins/lazy-load/">Lazy Load</a>, <a href="https://wordpress.org/plugins/a3-lazy-load/">a3 Lazy Load</a> and <a href="https://wordpress.org/plugins/rocket-lazy-load/">Rocket Lazy Load</a>.</p></li>
</ul>

<h3 id="makecustomersupportandeducationyourpillarsofstrength">Make customer support and education your pillars of strength</h3>

<p>Instead of feeding your customers lots of confusing and time-consuming theme options, try offering full support and education on how to use your themes, image optimization, WordPress 101, etc.</p>

<p>You can do so using:</p>

<ul>
  <li>blog posts</li>
  <li>downloadable guides</li>
  <li>video tutorials</li>
  <li>FAQs on your website</li>
  <li>a ticket system for more specific issues that might arise while using your themes.</li>
</ul>

<p>Sharing the basic know-how about your products and the platform you build for is a great way of making your themes easy to use for your customers and contributes to generate a high level of trust, which is at the core of a healthy and successful business.</p>

<h2>Sometimes Flexibility Wins over Performance</h2>

<p>There may be a limited number of cases when you don't think compromising some flexibility for the sake of a small performance gain is a good idea.</p>

<p>A couple of examples come to mind.</p>

<h3 id="whenwritingdrycodecouldmakeyourcustomersunhappy">When writing DRY code could make your customers unhappy</h3>

<p>The first example comes from <a href="https://twitter.com/tommcfarlin">Tom McFarlin</a>, a well-known WordPress theme developer and author.</p>

<p>In his blog he explains why he decided to include a long list of <a href="https://developer.wordpress.org/themes/template-files-section/partial-and-miscellaneous-template-files/">WordPress template files</a>, thereby going against the <a href="https://en.wikipedia.org/wiki/Don't_repeat_yourself">DRY</a> coding principle (and also impacting negatively on performance to some extent) while developing his theme <em>Meyer</em>.</p>

<p><em>Meyer</em> was targeted at bloggers and digital publishers without much WordPress technical knowledge. Knowing that lack of coding experience would not have stopped this audience from tinkering with his theme, Tom McFarlin thought of a way to make things easier for them. He provided his customers with a generous number of template files they could easily copy and paste into a <a href="https://www.sitepoint.com/watch-create-your-first-wordpress-child-theme-quick-fast/">WordPress child theme</a> for customization without hacking the original theme.</p>

<p>McFarlin writes:</p>

<blockquote>
  <p>If the templates are defined in the base theme &mdash; rather than, say, a bunch of developer-ish conditionals &mdash; users are going to have an easier time basing their templates off of something that already exists …</p>
  <p>So if I had to sum this up in some concise way, I’d say that I &mdash; like many developers &mdash; want to keep my code as DRY as possible, but there’s a tradeoff that comes with doing so in the context of WordPress theme development.</p>
  <p>And I don’t think that staying DRY is the best way to go about it if you’re going to be marketing a product to a wide audience.</p>
  <p><a href="https://tommcfarlin.com/wordpress-theme-development-thinking-of-the-blogger/">Know Your Customer &mdash; the Blogger</a>.</p>
</blockquote>

<h3 id="staticsourcecodeisbetterforperformancebutdonotuseitinyourpublicthemes">Static source code is better for performance but don't use it in your public themes</h3>

<p>My second example of when not to compromise flexibility for some performance gain in your WordPress themes is based on performance advice from the Codex.</p>

<p>You'll find some great performance tips there, but there's one I wouldn't recommend you use, at least if you're going to release your theme to the general public.</p>

<p>It goes like this:</p>

<blockquote>
  <ul>
    <li><p>Can static values be hardcoded into your themes? This will mean you have to edit code every time you make changes, but for generally static areas, this can be a good trade off.</p>
    <ul>
      <li>
        <p>For example, your site charset, site title, and so on.</p>
      </li>
      <li>
        <p>Can you hardcode menus that rarely change? Avoiding functions like <code>wp_list_pages()</code> for example. </p>
      </li>
    </ul>
    </li>
  </ul>
  <p><a href="https://codex.wordpress.org/WordPress_Optimization/WordPress_Performance">Codex &mdash; WordPress Optimization/WordPress Performance</a></p>
</blockquote>

<p>Avoiding unnecessary calls to the database and optimizing your SQL queries are excellent practices every theme should follow.</p>

<p>If your theme runs a bit slow, try looking for problematic database queries that take too long to execute. You can use a plugin like <a href="https://wordpress.org/plugins/query-monitor/">Query Monitor</a> in your development environment to help you with this task.</p>

<p>However, hardcoding bits of information like site title, menu items, etc., is out of the question. Even if your users never change that info once it's set, they need to set it at least once and they rightly expect to do so using WordPress dynamic capabilities. </p>

<p>Furthermore, even if your theme's users were prepared to dig into the source code, they would have to hack the theme files to add the required data. This is almost never a good idea, not least because all changes would be overwritten on the next theme update.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Coding WordPress themes for the general public may involve catering for diverse and sometimes incompatible needs: those of your customer base, of web performance, hence the needs of visitors of those websites that use your themes, and even your own needs as WordPress theme designer and creator.</p>

<p>In this article I've expressed my views on how to address the dilemma WordPress theme developers might face between the demands of flexibility and those of performance.</p>
<h1>Five Techniques to Lazy Load Images for Website Performance</h1>
<h3>Maria Antonietta Perna</h3>

<p><em>This article is part of a series created in partnership with <a href="https://www.siteground.com/sitepoint-recommended?afcode=97a975da3502771c04e59cbae092b1dd&campaign=lazy-load" rel="nofollow">SiteGround</a>. Thank you for supporting the partners who make SitePoint possible.</em></p>

<p><strong>With images making up a whopping <a href="http://httparchive.org/interesting.php?a=All&l=Mar%2015%202017#bytesperpage">65%</a> of all web content, page load time on websites can easily become an issue.</strong></p>

<p>Even when <a href="https://www.sitepoint.com/saving-bandwidth-by-using-images-the-smart-way/">properly optimized</a>, images can weigh quite a bit. This can have a negative impact on the time visitors have to wait before they can access content on your website. Chances are, they get impatient and navigate somewhere else, unless you come up with a solution to image loading that doesn't interfere with the perception of speed.</p>

<p>In this article, you will learn about five approaches to lazy loading images that you can add to your web optimization toolkit to improve the user experience on your website.</p>

<h2 id="what-is-lazy-loading">What Is Lazy Loading?</h2>

<p>Lazy loading images means loading images on websites asynchronously --- that is, after the above-the-fold content is fully loaded, or even conditionally, only when they appear in the browser’s viewport. This means that if users don't scroll all the way down, images placed at the bottom of the page won't even be loaded.</p>

<p>A number of websites use this approach, but it's especially noticeable on image-heavy sites. Try browsing your favorite online hunting ground for high-res photos, and you'll soon realize how the website loads just a limited number of images. As you scroll down the page, you'll see placeholder images quickly filling up with real images for preview. For instance, notice the loader on <a href="https://unsplash.com/">Unsplash.com</a>: scrolling that portion of the page into view triggers the replacement of a placeholder with a full-res photo:</p>

<img src="https://www.sitepoint.com/wp-content/uploads/2017/04/1492178800lazy-loading-unsplash.png" alt="Lazy loading in action on Unsplash.com" width="700" height="315" class="aligncenter size-full wp-image-152546" />

<h2 id="why-should-you-care-about-lazy-loading-images">Why Should You Care About Lazy Loading Images?</h2>

<p>There are at least a couple of excellent reasons why you should consider lazy loading images for your website:</p>

<ul>
<li>
If your website uses JavaScript to display content or provide some kind of functionality to users, loading the DOM quickly becomes critical. It's common for scripts to wait until the DOM has completely loaded before they start running. On a site with a significant number of images, lazy loading --- or loading images asynchronously --- could make the difference between users staying or leaving your website.
</li>
<li>
Since most lazy loading solutions work by loading images only if the user has scrolled to the location where images would be visible inside the viewport, those images will never be loaded if users never get to that point. This means considerable savings in bandwidth, for which most users, especially those accessing the web on mobile devices and slow-connections, will be thanking you.
</li>
</ul>

<p>Well, lazy loading images helps with website performance, but what's the best way to go about it?</p>

<p>There is no perfect way.</p>

<p>
If you live and breathe JavaScript, implementing your own lazy loading solution shouldn't be an issue. Nothing gives you more control than coding something yourself.
</p>

<p>
Alternatively, you can browse the web for viable approaches and start experimenting with them. I did just that and came across these five interesting techniques.
</p>


<h2 id="david-walsh-simple-image-lazy-load-and-fade">#1 David Walsh's Simple Image Lazy Load and Fade</h2>

<p>David Walsh has proposed his own custom script for lazy loading images. Here's a simplified version:</p>

<p>The <code>src</code> attribute of the <code>img</code> tag is replaced with a <code>data-src</code> attribute in the markup:</p>

[code language="html"]
&lt;img data-src="image.jpg" alt="test image"&gt;
[/code]

 <p>In the CSS, <code>img</code> elements with a <code>data-src</code> attribute are hidden. Once loaded, images will appear with a nice fade-in effect using CSS transitions:</p>

[code language="css"]
img {
  opacity: 1;
  transition: opacity 0.3s;
}

img[data-src] {
  opacity: 0;
}
[/code]

 <p>JavaScript then adds the <code>src</code> attribute to each <code>img</code> element and gives it the value of their respective <code>data-src</code> attributes. Once images have finished loading, the script removes the <code>data-src</code> attribute from <code>img</code> elements altogether:</p>

[code language="js"]
[].forEach.call(document.querySelectorAll('img[data-src]'),    function(img) {
  img.setAttribute('src', img.getAttribute('data-src'));
  img.onload = function() {
    img.removeAttribute('data-src');
  };
});
[/code]

<p>David Walsh also offers a fallback solution to cover cases where JavaScript fails, which you can find out more about on <a href="https://davidwalsh.name/lazyload-image-fade">his blog</a>.</p>

<p>The merit of this solution: it's a breeze to implement and it's effective.</p>

<p>On the flip side, this method doesn't include loading on scroll functionality. In other words, all images are loaded by the browser, whether users have scrolled them into view or not. Therefore, you get the advantage of a fast loading page because images are loaded after the HTML content. However, you don't get the saving on bandwidth that comes with preventing unnecessary image data from being loaded when visitors don't view the entire page content.</p>

<h2 id="robin-osborne-progressively-enhanced-lazy-loading">#2 Robin Osborne's Progressively Enhanced Lazy Loading</h2>

<p>Robin Osborne suggests a super ingenious solution based on <a href="https://en.wikipedia.org/wiki/Progressive_enhancement">progressive enhancement</a>. In this case, lazy loading itself, which is achieved using JavaScript, is considered the enhancement over regular HTML and CSS.</p>

<p>Why progressive enhancement? Well, if you display images using a JavaScript-based solution, what happens if JavaScript is disabled or an error occurs which prevents the script from working as expected? In this case, without progressive enhancement, users are likely to see no images at all. Not cool.</p>

<p>You can see the details of a basic version of Osborne's solution in this <a href="http://codepen.io/rposbo/pen/ONmgVG">Pen</a>, and a more comprehensive one, which takes into account the case for <em>broken JavaScript</em>, in this other <a href="http://codepen.io/rposbo/pen/EKmXvo">Pen here</a>.</p>

<p>This technique has a number of advantages:</p>

<ul>
<li>The progressive enhancement approach ensures users always have access to content.</li>
<li>Not only does it cater for a situation where JavaScript is not available, but also for those cases when JavaScript is <em>broken</em>: we all know how error-prone scripts can be, especially in an environment where a significant number of scripts are running.</li>
<li>It lazy loads images on scroll, so not all images will be loaded if users don't scroll to their location in the browser.</li>
<li>It doesn't rely on any external dependencies, hence no frameworks or plugins are necessary.</li>
</ul>

<p>You can learn all the details of Robin Osborne's approach on <a href="https://www.robinosborne.co.uk/2016/05/16/lazy-loading-images-dont-rely-on-javascript/">his blog</a>.</p>

<h2 id="lazy-load-xt-jquery-plugin">#3 Lazy Load XT jQuery Plugin</h2>

<p>A quick and easy alternative for implementing lazy loading of images is to let a JavaScript/jQuery plugin do the heavy lifting for you.</p>

<p>Lazy Load XT is a feature-packed jQuery plugin. You can opt for a simplified version called <code>jquery.lazyloadxt.js</code>, which lets you just lazy load images. Alternatively, you can use <code>jquery.lazyloadxt.extra.js</code>, which is an extended version of the plugin. With the extended version, you can lazy load iframes, videos, and generally all tags that use a <code>src</code> attribute.</p>

<p>To include Lazy Load XT in your project, at the bottom of your HTML page before the closing <code>&lt;/body&gt;</code> tag, add the <a href="http://jquery.com/">jQuery library</a>, followed by one of the two Lazy Load XT flavors mentioned above. For instance:</p>

[code language="html"]
&lt;script src="jquery.js"&gt;&lt;/script&gt;
&lt;script src="jquery.lazyloadxt.js"&gt;&lt;/script&gt;
[/code]

<p>If you don't want to use jQuery, Lazy Load XT offers a much lighter option, a <a href="https://raw.githubusercontent.com/ressio/lazy-load-xt/master/dist/jqlight.lazyloadxt.min.js">small script called <code>jqlight.lazyloadxt.min.js</code></a>:
 </p>

[code language="html"]
&lt;script src="jqlight.lazyloadxt.js"&gt;&lt;/script&gt;
&lt;script src="jquery.lazyloadxt.js"&gt;&lt;/script&gt;
[/code]

<p>In your HTML document, mark up images using a <code>data-src</code> attribute instead of the regular <code>src</code> attribute, like this:</p>

[code language="html"]
&lt;img data-src="lazy.jpg" width="100" height="100" alt="test image"&gt;
[/code]

<p>You can then leave the plugin to initialize itself, or you can manually initialize it yourself. For instance, to initialize a selection of elements write:</p>

[code language="js"]
$(elements).lazyLoadXT();
[/code]

<p>This plugin makes tons of add-ons for extra functionality available. To mention just a couple:</p>

<ul>
<li>By adding <code>jquery.lazyloadxt.spinner.css</code>, you can display an animated spinner as the image is loading.</li>
<li>You can add all the <a href="https://github.com/daneden/animate.css">Animate.css</a> fun effects for image loading if you just include <code>animate.min.css</code> in your project and write this line of code in your JavaScript file: <code>$.lazyLoadXT.onload.addClass = 'animated bounceOutLeft';</code>. Of course, you can replace <code>bounceOutLeft</code> with any of the effects Animate.css provides.</li>
</ul>

<p>Among the advantages of Lazy Load XT and its add-ons are:</p>

<ul>
<li>CDN hosting support so you don't need to download Lazy Load XT scripts to your server.</li>
<li>Wide browser support, including IE6-11 and Opera Mini.</li>
<li>You can lazy load images on the page, in scrollable containers, in both vertical and horizontal scroll layouts, and in infinite scrolling scenarios.</li>
<li>Using add-ons you can create great transition effects, implement support for retina screens, lazy load background images, and much more.</li>
<li>You can lazy load different media types.</li>
<li>The documentation shows how you can counteract the eventuality of browsers with JavaScript disabled.</li>
<li>You don't need to include the full jQuery library to use this plugin for lazy loading images.</li>
</ul>

<p>For a full list of options and add-ons, visit the <a href="https://github.com/ressio/lazy-load-xt">Lazy Load XT repo on GitHub</a>.</p>

<h2 id="blazy-vanilla-javascript-plugin">#4 bLazy.js &mdash; Vanilla JavaScript Plugin</h2>

<img src="https://www.sitepoint.com/wp-content/uploads/2017/04/1492179640blazy-plugin.png" alt="bLazy jQuery plugin for lazy loading images." width="511" height="161" class="aligncenter size-full wp-image-152547" />

<p>bLazy is a smart vanilla JavaScript plugin for lazy loading images. More specifically:</p>

<blockquote>
<p>bLazy is a lightweight lazy loading image script (less than 1.2KB minified and gzipped). It lets you lazy load and multi-serve your images so you can save bandwidth and server requests. The user will have faster load times and save data loaded if he/she doesn't browse the whole page.</p>
<p><a href="http://dinbror.dk/blazy/">bLazy website</a></p>
</blockquote>

<p>This small, dependency-free plugin lets you:</p>

<ul>
<li>lazy load both embedded images and background images</li>
<li>serve different images according to screen size and high resolution screens</li>
<li>lazy load everything with a <code>src</code> attribute, e.g., iframes, HTML5 videos, scripts, unity games etc.</li>
<li>lazy load images inside a scrolling container</li>
<li>support legacy browsers, back to IE7 and IE8</li>
<li>use a CDN, so you don't need bLazy hosted on your server.</li>
</ul>

<p>Here's a basic implementation.</p>

<p>The markup:</p>

[code language="html"]
&lt;img class="b-lazy" src="placeholder.gif" data-src="image.jpg" alt="test image"&gt;
[/code]

<p>You need to modify the regular <code>img</code> tag as follows:</p>

<ul>
<li>Add a class of <code>.b-lazy</code>.</li>
<li>Use a placeholder image as value for the <code>src</code> attribute. To save HTTP requests, you can also use an inline <a href="http://probablyprogramming.com/2009/03/15/the-tiniest-gif-ever">base64-encoded transparent gif</a>. But beware, doing so won't have the benefits of caching on subsequent pages where you use the same image.</li>
<li>The <code>data-src</code> attribute points to the image you want to lazy load.</li>
</ul>

<p>The JavaScript: enter a simple call to bLazy and fine-tune with a map of options:</p>

[code language="js"]
var bLazy = new Blazy({
  //options here
});
[/code]

<p>To learn more on bLazy and its available options, follow these links:</p>

<ul>
<li><a href="http://dinbror.dk/blog/blazy/?ref=demo-page">bLazy.js – A lazyload image script</a></li>
<li><a href="http://dinbror.dk/blazy/">bLazy.js Website</a></li>
<li><a href="http://dinbror.dk/blazy/examples/?ref=blog">bLazy.js Examples</a></li>
<li><a href="https://github.com/dinbror/blazy/">bLazy.js Project on GitHub</a>.</li>
</ul>

<h2 id="lazy-loading-with-blurred-image-effect">#5 Lazy Loading with Blurred Image Effect</h2>

<p>If you are a <a href="https://medium.com/">Medium</a> reader, you have certainly noticed how the site loads the main image inside a post.</p>

<p>The first thing you see is a blurred, low-resolution copy of the image, while its high-res version is being lazy loaded:</p>

[caption id="attachment_152548" align="aligncenter" width="700"]<img src="https://www.sitepoint.com/wp-content/uploads/2017/04/1492179905medium-blurred.png" alt="Blurred placeholder image on Medium website." width="700" height="409" class="size-full wp-image-152548" /> Blurred placeholder image on Medium website.[/caption]

[caption id="attachment_152549" align="aligncenter" width="700"]<img src="https://www.sitepoint.com/wp-content/uploads/2017/04/1492179959medium-regular.png" alt="High-res, lazy loaded image on Medium website." width="700" height="410" class="size-full wp-image-152549" /> High-res, lazy loaded image on Medium website.[/caption]

<p>You can lazy load images with this interesting blurring effect in a number of ways. </p>

 <p>
   My favorite technique is by Craig Buckler. Here's all the goodness of this solution:
 </p>

<ul>
<li>Performance: only 463 bytes of CSS and 1,007 bytes of minified JavaScript code</li>
<li>Support for retina screens</li>
<li>Dependency-free: no jQuery or other libraries and frameworks required</li>
<li>Progressively enhanced to counteract older browsers and failing JavaScript</li>
</ul>

<p>You can read all about it in <a href="https://www.sitepoint.com/how-to-build-your-own-progressive-image-loader/">How to Build Your Own Progressive Image Loader</a> and download the code on the project's <a href="https://github.com/craigbuckler/progressive-image.js">GitHub repo</a>.</p>

<h2 id="conclusion">Conclusion</h2>

<p>And there you have it --- five ways of lazy loading images you can start to experiment with and test out in your projects.</p>
<h1>Optimizing CSS: ID Selectors and Other Myths</h1>
<h3>Ivan Čurić</h3>

<p><strong>In today’s typical scenario, where the average website ships 500KB of gzipped JavaScript and 1.5MB of images, running on a midrange Android device via 3G with a 400ms round trip time, CSS selector performance is the least of our problems.</strong></p>

<p>Still, there’s something to be said about the topic, especially to weed out some of the myths and legends surrounding them. So let’s dive right in.</p>

<h2 id="thebasicsofcssparsing">The Basics of CSS Parsing</h2>

<p>First, to get on the same page --- this article isn’t about the performance of CSS properties and values. What we’re covering here is the performance cost of the selectors themselves. I'll be focusing on the Blink rendering engine, specifically Chrome 62.</p>

<p>The selectors can be split into a few groups and (roughly) sorted from the least to most expensive:</p>

<table>
<thead>
<tr>
<th>rank</th>
<th>type</th>
<th>example</th>
</tr>
</thead>
<tbody>
<tr>
<td>1.</td>
<td>ID</td>
<td><code>#classID</code></td>
</tr>
<tr>
<td>2.</td>
<td>Class</td>
<td><code>.class</code></td>
</tr>
<tr>
<td>3.</td>
<td>Tag</td>
<td><code>div</code></td>
</tr>
<tr>
<td>4.</td>
<td>General and adjacent sibling</td>
<td><code>div ~ a</code>, <code>div + a</code></td>
</tr>
<tr>
<td>5.</td>
<td>Child and descendant</td>
<td><code>div &gt; a</code>, <code>div a</code></td>
</tr>
<tr>
<td>6.</td>
<td>Universal</td>
<td><code>*</code></td>
</tr>
<tr>
<td>7.</td>
<td>Attribute</td>
<td><code>[type="text"]</code></td>
</tr>
<tr>
<td>8.</td>
<td>Pseudo-classes and elements</td>
<td><code>a:first-of-type</code>, <code>a:hover</code></td>
</tr>
</tbody>
</table>

<p>Does this mean that you should only use IDs and classes? Well … not really. It depends. First, let’s cover how browsers interpret CSS selectors.</p>

<p>Browsers read CSS from right to left. The rightmost selector in a compound selector is known as the <strong>key</strong> selector. So, for instance, in <code>#id .class &gt; ul a</code>, the key selector is <code>a</code>. The browser first matches all key selectors. In this case, it finds all elements on the page that match the <code>a</code> selector. It then finds all <code>ul</code> elements on the page and filters the <code>a</code>s down to just those elements that are descendants of <code>ul</code>s --- and so on until it reaches the leftmost selector.</p>

<p>Therefore, the shorter the selector, the better. If possible, make sure that the key selector is a class or an ID to keep it fast and specific.</p>

<h2 id="measuringtheperformance">Measuring the Performance</h2>

<p>Ben Frain created <a href="https://benfrain.com/css-performance-revisited-selectors-bloat-expensive-styles/">a series of tests</a> to measure selector performance back in 2014. The test consisted of an enormous DOM comprising 1000 identical elements, and measuring the speed it took to parse various selectors, ranging from IDs to some seriously complicated and long compound selectors. What he found was that the delta between the slowest and fastest selector was ~15ms.</p>

<p>However, that was back in 2014. Things have changed a lot since then, and memorizing rules is all but useless in the ever-changing browser landscape. Always remember to do your own tests, especially when performance is concerned.</p>

<p>I went to do my own tests, and for that I used Paul Lewis' test mentioned in <a href="https://alistapart.com/comments/quantity-queries-for-css#338752">Paul Irish's comment</a> expressing concern over the useful, yet convoluted "<a href="https://alistapart.com/article/quantity-queries-for-css">quantity selectors</a>”:</p>

<blockquote>
  <p>These selectors are among the slowest possible. ~500 slower than something wild like “div.box:not(:empty):last-of-type .title”. Test page http://jsbin.com/gozula/1/quiet</p>
</blockquote>

<p>The test was bumped up a bit, to 50000 elements, and you can <a href="https://codepen.io/ivancuric/pen/ZaWxqV">test it out yourself</a>. I did an average of 10 runs on my 2014 MacBook Pro, and what I got was the following:</p>

<table>
<thead>
<tr>
<th>Selector</th>
<th>Query Time (ms)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>div</code></td>
<td>4.8740</td>
</tr>
<tr>
<td><code>.box</code></td>
<td>3.625</td>
</tr>
<tr>
<td><code>.box &gt; .title</code></td>
<td>4.4587</td>
</tr>
<tr>
<td><code>.box .title</code></td>
<td>4.5161</td>
</tr>
<tr>
<td><code>.box ~ .box</code></td>
<td>4.7082</td>
</tr>
<tr>
<td><code>.box + .box</code></td>
<td>4.6611</td>
</tr>
<tr>
<td><code>.box:last-of-type</code></td>
<td>3.944</td>
</tr>
<tr>
<td><code>.box:nth-of-type(2n - 1)</code></td>
<td>16.8491</td>
</tr>
<tr>
<td><code>.box:not(:last-of-type)</code></td>
<td>5.8947</td>
</tr>
<tr>
<td><code>.box:not(:empty):last-of-type .title</code></td>
<td>8.0202</td>
</tr>
<tr>
<td><code>.box:nth-last-child(n+6) ~ div</code></td>
<td>20.8710</td>
</tr>
</tbody>
</table>

<p>The results will of course vary depending on whether you use <code>querySelector</code> or <code>querySelectorAll</code>, and the number of matching nodes on the page, but <code>querySelectorAll</code> comes closer to the real use case of CSS, which is targeting all matching elements.</p>

<p>Even in such an extreme case, with 50000 elements to match, and using some really insane selectors like the last one, we find that the slowest one is ~20ms, while the fastest is the simple class at ~3.5ms. Not really that much of a difference. In a realistic, more "tame" DOM, with around 1000–5000 nodes, you can expect those results to drop by a factor of 10, bringing them to sub-millisecond parsing speeds.</p>

<p>What we can see from this test is that it's not really worth it to worry over CSS selector performance. Just don't overdo it with pseudo selectors and really long selectors. We can also see how Blink improved in the last two years. Instead of the stated ~500x slowdown for a "quantity selector" (<code>.box:nth-last-child(n+6) ~ div</code>) compared to an "insanity selector" (<code>.box:not(:empty):last-of-type .title</code>), we only see a ~1.5x slowdown. That's an amazing improvement, and we can only expect browsers to get better, making CSS selector performance even less impactful.</p>

<p>You <em>should</em>, however, stick to using classes whenever possible, and adopt some sort of namespacing convention like BEM, SMACSS or OOCSS, since it will not only help your website's performance but vastly help with code maintainability. Overqualified compound selectors, especially when used with tag and universal selectors --- such as <code>.header nav ul &gt; li a &gt; .inner</code> --- are extremely brittle and a source of many unforeseen errors. They are also a nightmare to maintain, especially if you inherit the code from someone else.</p>

<h2 id="qualityoverquantity">Quality over Quantity</h2>

<p>A bigger problem of simply having expensive selectors is having <em>a lot</em> of them. This is know as "style bloat", and you've probably seen the problem a lot. Typical examples are sites which import entire CSS frameworks like Bootstrap or Foundation, while using less than 10% of the transferred CSS. Another example is seen in old, never-refactored projects whose CSS has devolved into, as I like to call them, "Chronological Style Sheets" --- CSS with a ton of appended classes to the end of the file as the project has changed and grown, now looking more like an overgrown garden full of weeds.</p>

<p>Not only does a large CSS file take longer to transfer, (and network is the <em>biggest</em> bottleneck in website performance), they also take longer to parse. As well as constructing the DOM from your HTML, the browser needs to construct a CSSOM (CSS Object Model) to compare it with the DOM and match the selectors.</p>

<p>So, keep your styles lean and DRY, don't include everything and the kitchen sink, load what you need and when you need it, and use <a href="https://github.com/giakki/uncss">UNCSS</a> if you need to.</p>

<p>If you want to dig more into how the browsers parse CSS, <a href="https://calendar.perfplanet.com/2011/css-selector-performance-has-changed-for-the-better/">check out Nicole Sullivan's post on Webkit</a>, <a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/constructing-the-object-model">Ilya Grigorik's article on how Blink does it</a>, or <a href="https://hacks.mozilla.org/2017/08/inside-a-super-fast-css-engine-quantum-css-aka-stylo/">Lin Clark's article on Mozilla's new Stylo CSS engine</a>.</p>

<h2 id="theelephantintheroomstyleinvalidation">The Elephant in the Room: Style Invalidation</h2>

<p>What we've covered so far is fine, but we've only discussed a single rendering pass. Today's websites are no longer static documents, but resemble apps with dynamic content users can interact with.</p>

<p>This complicates things, since parsing CSS is only a single step in the browser rendering pipeline. Here's a render-oriented view of how a browser renders a single frame to the screen (source: <a href="https://developers.google.com/web/fundamentals/performance/rendering/images/intro/frame-full.jpg">Google</a>):</p>

<p><img src="https://www.sitepoint.com/wp-content/uploads/2017/11/1510297945frame-full-1024x156.jpg" alt="The browser rendering pipeline" width="1024" height="156" class="aligncenter size-large wp-image-161403" /></p>

<p>We won't be going into JavaScript performance and compositing, but will focus instead on the purple part --- style parsing and laying out the elements.</p>

<p>After constructing the DOM and CSSOM, the browser needs to combine the two into a render tree before finally painting it on the screen. In that step, the browser needs to figure out the computed CSS for each matching element. You can see this yourself in the <strong>Elements > Styles</strong> panel of the developer tools. It takes all the matching styles, the cascade, and browser-specific user agent styles to construct the final, computed CSS for the element.</p>

<p>It can then proceed to the layout (also known as reflow) step, where it computes the geometry, and constructs the box model of the page, placing each element on its respective position on the viewport. Layout is the most computationally intensive part of this process.</p>

<p>Finally, the browser converts each node in the render tree to actual pixels on the screen in the paint stage.</p>

<p>Now, what happens when we mutate the DOM by <em>changing</em> some classes on the page, adding or removing some nodes, modifying some attributes, or in any way messing with the HTML (<a href="https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleSheet">or the stylesheets themselves</a>)?</p>

<p>We invalidate the computed styles and the browser needs to invalidate <em>everything</em> down the tree of the matched selectors. While today's browsers are much smarter, it used to be the case that if you changed a class on the <code>body</code> element, all the descendant elements needed to have their computed styles recalculated.</p>

<p>One way to avoid this issue is to reduce the complexity of your selectors. Instead of writing <code>#nav &gt; .list &gt; li &gt; a</code>, use a single selector, like <code>.nav-link</code>. That way, you reduce the scope of style invalidation, since if you modify anything inside the <code>#nav</code>, you won't trigger recalculations for the entire node.</p>

<p>Another way is to reduce the scope --- such as the number of invalidated elements. Be specific with your CSS. Keep this in mind especially during animations, where the browser has only ~10ms to do all the work required.</p>

<p>If you want to get down to the nitty gritty details of style invalidation, I recommend reading <a href="https://docs.google.com/document/d/1vEW86DaeVs4uQzNFI5R-_xS9TcS1Cs_EUsHRSgCHGu8/edit">Style Invalidation in Blink</a>.</p>

<h2 id="conclusion">Conclusion</h2>

<p>To sum it up, you shouldn't worry about selector performance, unless you <em>really</em> go overboard. While the topic was all the rage in 2012, browsers have gotten <em>a lot</em> faster and smarter since. Even Google doesn't worry about it anymore. If you check out Google's <a href="https://developers.google.com/speed/docs/insights/rules">Page Speed Insights page</a>, you won't see the rule "Use efficient CSS selectors" <a href="https://web.archive.org/web/20130330123924/https://developers.google.com/speed/docs/insights/rules">which was removed in 2013.</a></p>

<p>Instead, focus on making your CSS maintainable and readable. Your colleagues and your future self will thank you for it. Try to optimize the CSS delivery by including only the used styles. And after that, get to know the rendering pipeline. Unlike selectors, styles themselves <em>can</em> be expensive, and <a href="https://www.sitepoint.com/check-css-animation-performance-with-the-browsers-dev-tools/">the difference between a janky site and a smooth one</a> can often be found in how the CSS is implemented.</p>

<p>And as a final note: always do your own tests.</p>

<p>Don't just believe what someone wrote on the internet a few years ago. The landscape is changing drastically and at an incredible pace. What's relevant today might become obsolete sooner than you know.</p>
<h1>Optimizing CSS: Tweaking Animation Performance with DevTools</h1>
<h3>Maria Antonietta Perna</h3>


<p><em>This article is part of a series created in partnership with <a href="https://www.sitepoint.com/siteground-recommended-65-off" rel="nofollow">SiteGround</a>. Thank you for supporting the partners who make SitePoint possible.</em></p>

<p><strong>CSS animations are known to be super performant. Although this is the case for simple animations on a few elements, if you didn't code your animations with performance in mind and add more complexity, website users will soon take notice and possibly get annoyed.</strong></p>

<p>In this article, I introduce some useful browser DevTools features that will enable you to check what happens under the hood when animating with CSS. This way, when an animation looks a bit choppy, you'll have a better idea why and what you can do to fix it.</p>

<h2 id="firefoxdevelopertoolsforcssperformance">Developer Tools for CSS Performance</h2>

<p>Your animations need to hit 60 fps (frames per second) to run fluidly in the browser. The lower the rate, the worse your animation will look. This means the browser has no more than about 16 milliseconds to do its job for one frame. But what does it do during that time? And how would you know if your browser is keeping up with the desired framerate?</p>

<p>I think nothing beats user experience when it comes to assessing the quality of an animation. However, developer tools in modern browsers, while not always 100% reliable, have been getting smarter and smarter, and there's quite a bit you can do to review, edit and debug your code using them.</p>

<p>This is also true when you need to check framerate and CSS animation performance. Here's how it works.</p>

<h2 id="exploringtheperformancetoolinfirefox">Exploring the Performance Tool in Firefox</h2>

<p>In this article I use the Firefox Performance tool. The other big contender is the Chrome Performance Tool. You can pick your favorite, as both browsers offer powerful performance features.</p>

<p>To open the developer tools in Firefox, choose one of these options:</p>

<ul>
  <li>Right-click on your web page and choose <em>Inspect Element</em> in the context menu</li>
  <li>If you use the keyboard, press <kbd>Ctrl + Shift + I</kbd> on Windows and Linux or <kbd>Cmd + Opt + I</kbd> on macOS.</li>
</ul>

<p>Next, click on the <em>Performance</em> tab. Here, you'll find the button that lets you start a recording of your website's performance:</p>

<img src="https://www.sitepoint.com/wp-content/uploads/2017/05/1494616829devtools-performance-panel.png" alt="Performance panel in Firefox Developer Tools." width="600" height="201" class="aligncenter size-full wp-image-154250" />

<p>Press that button and wait for a few seconds or perform some action on the page. When you're done, click the <em>Stop Recording Performance</em> button:</p>

<img src="https://www.sitepoint.com/wp-content/uploads/2017/05/1494616877stop-recording.png" alt="Stop recording browser activity in the Performance panel." width="600" height="209" class="aligncenter size-full wp-image-154251" />

<p>In a split second, Firefox presents you with tons of well-organized data that will help you make sense of which issues your code is suffering from.</p>

<p>The result of a recording inside the <em>Performance</em> panel looks something like this:</p>

<img src="https://www.sitepoint.com/wp-content/uploads/2017/05/1494616916complete-recording-screenshot.png" alt="Results of the recording in the Performance panel." width="800" height="327" class="aligncenter size-full wp-image-154252" />

<p>The <em>Waterfall</em> section is perfect for checking issues related to CSS transitions and keyframe animations. Other sections are the <em>Call Tree</em> and the <em>JS Flame Chart</em>, which you can use to find out about bottlenecks in your JavaScript code.</p>

<p>The Waterfall has a summary section at the top and a detailed breakdown. In both, the data is color-coded:</p>

<ul>
  <li>Yellow bars refer to JavaScript operations.</li>
  <li>Purple bars refer to calculating HTML elements’ CSS styles (recalculate styles) and laying out your page (layout). Layout operations are quite expensive for the browser to perform, so if you animate properties that involve repeated layouts (also known as <em>reflows</em> --- such as <code>margin</code>, <code>padding</code>, <code>top</code>, <code>left</code>, etc. --- the results could be janky.</li>
  <li>Green bars refer to painting your elements into one or more bitmaps (Paint). Animating properties like <code>color</code>, <code>background-color</code>, <code>box-shadow</code>, etc., involves costly paint operations, which could be the cause of sluggish animations and poor user experience.</li>
</ul>

<p>You can also filter the type of data you want to inspect. For instance, I'm interested only in CSS-related data, so I can deselect everything else by clicking on the filter icon at the top left of the screen:</p>

<img src="https://www.sitepoint.com/wp-content/uploads/2017/05/1494616970performance-panel-filter.png" alt="Filter feature inside Firefox Performance Dev Tools." width="800" height="386" class="aligncenter size-full wp-image-154253" />

<p>The big green bar below the Waterfall summary represents information on the framerate. </p>

<p>A healthy representation would look quite high, but most importantly, consistent --- that is, without too many deep gaps.</p>

<p>Let's illustrate this with an example.</p>

<h3 id="theperformancetoolinaction">The Performance tool in action</h3>

<p>This is a simple <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Animations/Using_CSS_animations">CSS animation</a> using the <code>@keyframes</code> keyword. The test page looks like this:</p>

<img src="https://www.sitepoint.com/wp-content/uploads/2017/05/1494617022demo-page-visible-box.png" alt="Demo page with rectangular box visible." width="500" height="321" class="aligncenter size-full wp-image-154254" />

<img src="https://www.sitepoint.com/wp-content/uploads/2017/05/1494617057demo-page-disappearing-box.png" alt="Demo page with rectangular box about to slide out." width="499" height="341" class="aligncenter size-full wp-image-154255" />

<p>The rectangular purple box slides in and out of view in an infinite cycle.</p>

<p>I've done this by animating the <code>margin-left</code> property of the <code>&lt;div&gt;</code> element that represents the rectangular box on the screen. Here's what the <code>@keyframes</code> animation block looks like:</p>

[code language="css"]
@keyframes slide-margin {
  100% {
    margin-left: 0;
  }
}
[/code]

<p>The performance data I get from this animation looks like this:</p>

<img src="https://www.sitepoint.com/wp-content/uploads/2017/05/1494617156slide-margin-recording.png" alt="Recording of animating with margins in Firefox Performance panel of the developer tools." width="800" height="291" class="aligncenter size-full wp-image-154256" />

<p>The framerate visual looks a bit jagged and the framerate is an average of 44.82 fps, which is a bit low.</p>

<p>Also, notice all the layout and paint operations that take place during the animation. These are costly operations the browser performs on its main thread, which has a negative impact on performance.</p>

<p>Finally, if you access the <em>Inspector</em> tool, click in the <em>Animation</em> section and hover over the animation name, an information box pops up with all the relevant data about the current animation. If your animation were optimized, there would be a message stating the fact. In this case, there is no message:</p>

<img src="https://www.sitepoint.com/wp-content/uploads/2017/05/1494617204animation-panel-nonoptimized.png" alt="Animation panel inside the Inspector tool with info about the current animation." width="800" height="268" class="aligncenter size-full wp-image-154257" />

<p>Now, I'm going to change my code and make a new recording as the browser animates the CSS <code>translate3d()</code> property using this <code>@keyframes</code> block:</p>

[code language="css"]
@keyframes slide-three-d {
  100% {
    transform: translate3d(0, 0, 0);
  }
}
[/code]

<p>This is what the recording of the performance looks like:</p>

<img src="https://www.sitepoint.com/wp-content/uploads/2017/05/1494617268translate-recording.png" alt="Recording of animation done using translate3d." width="800" height="227" class="aligncenter size-full wp-image-154258" />

<p>Now the framerate is higher (56.83 fps) and the waterfall is showing no costly layout and paint operations.</p>

<p>Also, if you open the <em>Inspector</em> tab of the developer tools, access the <em>Animation</em> panel and hover the mouse over the name of the animation, you can see something like this:</p>

<img src="https://www.sitepoint.com/wp-content/uploads/2017/05/1494617317animation-panel.png" alt="Animation panel in the Inspector of Firefox Developer Tools." width="800" height="287" class="aligncenter size-full wp-image-154259" />

<p>The info box relative to the animation name states that all animations are optimized, which is good news for your website visitors.</p>

<h2 id="onlyanimatecssopacityandtransforms">Only Animate CSS <em>Opacity</em>, <em>Transforms</em> and <em>Filters</em></h2>

<p>You've probably heard this piece of advice before, but just in case, it's worth going over it again: if you want your animations to run smoothly, animate only CSS opacity, transforms and filters. Animating everything else will put your browser under pressure to perform costly tasks in very little time, which often doesn't yield the best results.</p>

<p>As the Performance tool in your browser confirms, repeated layout and paint operations are not your friend.</p>

<p>However, each browser handles CSS properties a bit differently. If you want to know exactly which browser triggers layout and paint operations for which properties (especially when updating values for those properties, which is what is involved in web animation), head over to <a href="https://csstriggers.com/">CSS Triggers</a>.</p>

<p>To ensure performant animations, a popular approach is to force the browser to hand over the work of changing some properties to the GPU (Graphical Processing Unit), which relieves the browser's main thread of some pressure and takes advantage of hardware acceleration. You can do so by using the <a href="https://developer.mozilla.org/en/docs/Web/CSS/will-change"><code>will-change</code> CSS property</a>, or the <code>translateZ(0) </code> and <code>translate3d(0,0,0)</code> hacks. All of these tricks will work, but if you overdo it you could actually get exactly what you're trying to avoid, i.e., janky animations.</p>

<p>I'm not going into the details of hardware acceleration for web animation performance, but if you'd like to dig deeper, take a look at the resources listed below.</p>

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="https://www.html5rocks.com/en/tutorials/speed/high-performance-animations/">High Performance Animations</a> by Paul Lewis and Paul Irish</li>
  <li><a href="http://blogs.adobe.com/webplatform/2014/03/18/css-animations-and-transitions-performance/">CSS animations and transitions performance: looking inside the browser</a> by Max Vujovic</li>
  <li><a href="https://developers.google.com/web/fundamentals/design-and-ui/animations/animations-and-performance">Animations and Performance</a> by Paul Lewis and Sam Thorogood</li>
  <li><a href="https://developers.google.com/web/fundamentals/performance/rendering/stick-to-compositor-only-properties-and-manage-layer-count">Stick to Compositor-Only Properties and Manage Layer Count</a> by Paul Lewis</li>
  <li><a href="https://dev.opera.com/articles/css-will-change-property/">Tricks for GPU Composited CSS</a> by Sara Soueidan</li>
  <li><a href="https://www.sitepoint.com/introduction-css-will-change-property/">An Introduction to the CSS will-change Property</a> by Nick Salloum</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Tools/Performance/Scenarios/Animating_CSS_properties">Animating CSS properties</a> by MDN</li>
</ul>
<h1>Lightning Fast Websites with Prefetching</h1>
<h3>Maria Antonietta Perna</h3>

<p><em>This article is part of a series created in partnership with <a href="https://www.siteground.com/go/article-sp" rel="nofollow">SiteGround</a>. Thank you for supporting the partners who make SitePoint possible.</em></p>

<p><strong>In this article, I'll discuss prefetching, what it is, and how developers can use it to wow visitors with high-performance websites.</strong></p>

<h2 id="whatisprefetching">What Is Prefetching?</h2>

<p>Although optimizing a website for initial page load is great, for the highly interactive websites users expect today, this might not be enough.</p>

<p>What if browsers knew which link users were about to click, or which page they were about to visit next, so that content could automagically appear on their screen at the speed of light?</p>

<p>Well, browsers <em>can</em> do that now. In fact, some major browsers are smart enough to make these kinds of guesses based on visitors' browsing patterns, document markup and structure, the user's device, connectivity, etc. Therefore, browsers already try to anticipate the resources needed to build the page visitors are likely to access, get those resources ready and display the page at warp speed when users request it. However, developers can use their knowledge of the website or web application to help browsers single out those crucial resources more accurately.</p>

<p>This is what prefetching is, a hint for browsers to foresee users' every browsing wish and make it come true in a snap.</p>

<p>You can find prefetching in the <strong><a href="https://w3c.github.io/resource-hints/">Resource Hints</a></strong> specification led by Ilya Grigorik.</p>

<p>In what follows, I'm going to discuss:</p>

<ul>
<li>DNS-prefetching</li>
<li>Link/Resource prefetching</li>
<li>Prerendering (Page prefetching)</li>
</ul>

<h2 id="dnsprefetching">DNS-Prefetching</h2>

<p>The internet is a network of computer-readable <a href="http://whatismyipaddress.com/ip-address">IP addresses</a> (e.g., 87.87.87.87) that are referenced by human-readable hostnames (e.g., yoursite.com). DNS is the protocol that converts hostnames into IP addresses.</p>

<p>Each time the browser makes an HTTP request for a resource on a different domain, it can spend a few milliseconds to resolve the domain to the associated IP address.</p>

<p>If a website has a Twitter or Facebook widget, Google Analytics, and perhaps one or two custom web fonts, then it must have links to other domains. This makes DNS lookups unavoidable.</p>

<p>DNS prefetching helps to decrease waiting time for visitors because the browser performs DNS lookups before it sends a request for resources located on other domains.</p>

<p>So, let's say developers know a website will make a request to somewidget.example.com. They can drop a hint for the browser suggesting it to go ahead and prefetch that hostname's DNS by adding a <code>rel</code> attribute to the link with the value of <code>dns-prefetch</code>, like this:</p>

[code language="html"]
&lt;link rel="dns-prefetch" href="//somewidget.example.com"&gt;
[/code]

<p>Now, when the request to somewidget.example.com takes place, the browser has already performed the DNS lookup ahead of time and users get the results delivered a bit sooner.</p>

<p><a href="http://caniuse.com/#search=dns-prefetch">Browser support for DNS-prefetch</a> at this time is present in all major desktop browsers. When support for DNS-prefetching is lacking, browsers simply retrieve resources in the usual way. No big deal.</p>

<p>What if the browser never requests the DNS-prefetched resource? Thankfully, DNS-prefetching is not a costly operation, since it doesn't send more than just a few hundred bytes over the network. Once again, no harm done.</p>

<h2 id="linkprefetching">Link Prefetching</h2>

<p>According to the <a href="https://w3c.github.io/resource-hints/#prefetch">spec</a>, link prefetching …</p>

<blockquote>
<p>is used to identify a resource that might be required by the next navigation, and that the user agent SHOULD fetch, such that the user agent can deliver a faster response once the resource is requested in the future.</p>
</blockquote>

<p>In other words, if developers have grounds to assume users are likely to visit a specific web page and know the browser needs some critical resources to deliver it, they can use the <code>prefetch</code> directive. This points the browser towards the resources it should fetch before users actually navigate to that page.</p>

<p>Keep in mind that prefetching only works with cacheable resources, such as JavaScript, images and so on. Here's what the code looks like:</p>

[code language="html"]
&lt;link rel="prefetch" href="//example.com/future-image.jpg"&gt;
[/code]

<p>The browser now knows that the <code>future-image.jpg</code> image is going to be needed soon, so it can prefetch it and store it locally in the cache. At that point, because the browser will have already done the time-consuming work of downloading the resource in the background, the benefit of this technique consists in super-fast rendering as soon as users click to access the relevant page requiring <code>future-image.jpg</code>.</p>

<p>Link prefetching is great at creating the perception of a fast-loading website, but it's a much more expensive operation than DNS-prefetching. If users never access the page which needs the prefetched asset, the browser will have downloaded unnecessary data and clogged up its cache.</p>

<p>At the time of writing, link prefetching is <a href="http://caniuse.com/#search=prefetch">supported by the latest versions of Chrome, Firefox, IE/Edge and Opera</a>. Non-supporting browsers will simply ignore the hint.</p>

<h2 id="pageprefetchingprerendering">Page Prefetching/Prerendering</h2>

<p>Implementing page prefetching or prerendering is just a matter of adding the <code>prerender</code> directive inside a link's <code>rel</code> attribute, like this:</p>

[code language="html"]
&lt;link rel="prerender" href="//example.com/future-page.html"&gt;
[/code]

<p>Prerendering goes all the way and literally creates an invisible version of the entire page users are likely to go to next, including applying CSS and executing JavaScript. As soon as users click on the relevant link, the ghost page instantly materializes before their eyes, replacing the old content.</p>

<p>If link prefetching can be an expensive operation, prerendering is even more so. In this case, browsers download an entire web page and all its resources on the basis of an expectation that users will visit that page, which ultimately may or may not happen.</p>

<p>At this time, prerendering is <a href="http://caniuse.com/#search=prerender">supported in IE/Edge, Chrome and Opera</a>.</p>

<h2 id="usecasesforlinkprefetchingandprerendering">Use Cases for Link Prefetching and Prerendering</h2>

<p>Since both link prefetching and (to a greater extent) prerendering don't come cheap, having a definite idea of when it's suitable to implement them on a web page is important.</p>

<p>Devs who plan on using resource hints should do so when they have solid grounds for assuming which resources to prefetch or prerender based on the website's content, users' behavior, analytics, etc.</p>

<p>The Resource Hints spec indicates a number of <a href="https://w3c.github.io/resource-hints/#use-cases">use cases</a> where link prefetching could benefit user experience:</p>

<ul>
<li>Search results &mdash; It's reasonable to assume users are interested in those results, therefore it's likely they're going to click the links leading to the content they're after.</li>
<li>Paginated content &mdash; Once users are reading the first page of a multi-page article, it's not too far-fetched to assume they're going to click the link that lands them on the next page.</li>
<li>Image galleries &mdash; Google devs use prefetching on Picasa Web Albums. If users are viewing a photo, developers are justified in guessing that the next photo is also going to be accessed, so they instruct the browser to download it as soon as possible.</li>
</ul>

<p>Similarly, Santiago Valdarrama offers some <a href="https://alistapart.com/article/one-step-ahead-improving-performance-with-prebrowsing">helpful tips</a> on when developers could reasonably consider implementing prerendering on a website:</p>

<blockquote>
<p>When deciding whether to prerender entire pages ahead of time, consider that Google prerenders the top results on its search page, and Chrome prerenders pages based on the historical navigation patterns of users. Using the same principle, you can detect common usage patterns and prerender target pages accordingly. You can also use it, just like resource prefetching, on questionnaires or surveys where you know users will complete the workflow in a particular order.</p>
</blockquote>

<h2 id="resources">Resources</h2>

<p>If you'd like to dig deeper, the following resources are a must-read:</p>

<ul>
<li><a href="https://w3c.github.io/resource-hints/">Resource Hints Specification</a></li>
<li><a href="https://www.sitepoint.com/web-performance-tricks-beyond-basics/">Web Performance Tricks &mdash; Beyond the Basics</a></li>
<li><a href="https://developers.google.com/speed/articles/prefetching">Prefetching resources</a></li>
<li><a href="https://css-tricks.com/prefetching-preloading-prebrowsing/">Prefetching, preloading, prebrowsing</a></li>
<li><a href="https://alistapart.com/article/one-step-ahead-improving-performance-with-prebrowsing">One Step Ahead: Improving Performance with Prebrowsing</a></li>
<li><a href="https://csswizardry.com/2013/01/front-end-performance-for-web-designers-and-front-end-developers/">Front-end performance for web designers and front-end developers</a></li>
</ul>

<h2 id="conclusion">Conclusion</h2>

<p>DNS-prefetching, link prefetching and prerendering are powerful optimization techniques. If <strong>implemented responsibly</strong>, on the basis of the knowledge developers have of web content and user behavior, prefetching can considerably improve user experience.</p>
<h1>Optimizing Web Fonts for Performance: the State of the Art</h1>
<h3>Maria Antonietta Perna</h3>

<p><em>This article is part of a series created in partnership with <a href="https://www.siteground.com/sitepoint-recommended?afcode=97a975da3502771c04e59cbae092b1dd&campaign=web-fonts" rel="nofollow">SiteGround</a>. Thank you for supporting the partners who make SitePoint possible.</em></p>


<p><strong><a href="http://httparchive.org/interesting.php#fonts">67% of webpages now use custom fonts</a>. However, popularity and widespread adoption haven't come without some performance and user experience-related issues.</strong></p>

<p>In this article, I'll go through what's not so good about the way web fonts are commonly used and loaded, as well as point you to well-tested workarounds and future standards-based solutions.</p>

<h2 id="whycustomwebfonts">Why Custom Web Fonts?</h2>

<p>Users come to your website for content. Therefore, great typography is crucial on the web: readability, legibility and well-crafted typographic design are a must for brand recognition and the success of your message.</p>

<p>The best way to achieve beautiful typography is by loading custom web fonts --- that is, font files that are not already installed on users' devices. </p>

<p>Since browser support for the CSS <code>@font-face</code> rule has become widespread, using custom web fonts in websites has increased by leaps and bounds. However, fonts can have a heavy file size, and loading extra resources on your website doesn't come without some negative impact on performance.</p>

<p>Since file size can certainly be an issue, paying attention to how custom web fonts are loaded comes to the forefront.</p>

<h2 id="whatistheflashofinvisibletextallabout">What Is the Flash of Invisible Text (FOIT) All About?</h2>

<p>The most common way of using a custom web font is to specify the fonts used inside a CSS <code>@font-face</code> declaration and leave the browser to its default behavior. This is not ideal. Since information about fonts is located in the CSS, by default browsers delay the loading of fonts until the CSS is parsed. That's not all. As <a href="https://www.zachleat.com/web/lazy-loading-webfonts/">Zach Leatherman</a> has made abundantly clear, to trigger a font download, a number of conditions must be met besides a valid <code>@font-face</code> declaration:</p>

<ul>
<li>an HTML node that uses the same <code>font-family</code> specified inside <code>@font-face</code></li>
<li>in Webkit and Blink browsers, that node must not be empty</li>
<li>in <a href="http://caniuse.com/#feat=font-unicode-range">browsers that support the unicode range descriptor</a> inside <code>@font-face</code>, the content must also match the specified unicode range.</li>
</ul>

<p>If all the points above are satisfied, the browser starts downloading the font. This means that the browser needs to have parsed not only the CSS code but also a website's text content before it can trigger a font's download. However, it's just when the <strong>font starts loading that web users are likely to experience the dreaded Flash Of Invisible Text</strong>, or <strong>FOIT</strong> for short.</p>

[caption id="attachment_152717" align="aligncenter" width="700"]<img src="https://www.sitepoint.com/wp-content/uploads/2017/04/1492627730foit-loading.png" alt="FOIT: Page at http://blog.instagram.com/ while fonts are loading on Firefox v.52. Text is invisible." width="700" height="373" class="size-full wp-image-152717" /> FOIT: Page at http://blog.instagram.com/ while fonts are loading on Firefox v.52. Text is invisible.[/caption]

[caption id="attachment_152718" align="aligncenter" width="700"]<img src="https://www.sitepoint.com/wp-content/uploads/2017/04/1492627776foit-loaded.png" alt="FOIT: Page at http://blog.instagram.com/ after fonts have been loaded on Firefox v.52. Text has become visible" width="700" height="377" class="size-full wp-image-152718" /> FOIT: Page at http://blog.instagram.com/ after fonts have been loaded on Firefox v.52. Text has become visible.[/caption]

<p>In other words, as soon as browsers start downloading a font, all text becomes invisible. So users look at a screen with no text for some time, which under sub-par network conditions can feel like forever. Furthermore, the way different browsers handle FOIT also varies:</p>

<ul>
<li>Blink and Firefox browsers tackle FOIT by introducing a three-second timeout: the text disappears for up to three seconds during font loading. If the font hasn't loaded within this time frame, the website displays a fallback font, which is subsequently replaced with the custom font once this is fully loaded. This behavior gives rise to what is known as <strong>FOUT</strong> (another acronym): <strong>Flash Of Unstyled Text</strong>.</li>
<li>Safari, the default Android Browser and Blackberry don't use a timeout but display no text until the custom font is loaded. If anything goes wrong and the font doesn't get loaded, users are left with invisible text on the screen.</li>
<li>IE/Edge browsers don't hide text, but display the fallback font right away, which seems to be a better design decision by Microsoft.</li>
</ul>

<p>Although having a sudden change in typeface when reading text on a website is not the best user experience, staring at a blank screen while the font is loading sounds much worse. Ideally, a working approach should overcome both FOUT and FOIT. However, although it's an open issue, there is some consensus among a number of experts that FOUT is way better than FOIT.</p>

<p>Tackling the issues related to loading fonts involves working both on optimizing the file size and taking control of the default browser behavior so as to eliminate FOIT and minimizing the jarring impact of FOUT.</p>

<p>Let's look closer into each task one at a time.</p>

<h2 id="tipsonoptimizingcustomfontfiles">Tips on Optimizing Custom Font Files</h2>

<p>There are a few steps you can take to make sure your font files are not super heavy.</p>

<h3 id="minimizethenumberoftypefacesinyourproject">#1 Minimize the number of typefaces in your project</h3>

<p>Don't think that just because you can choose from tons of beautiful typefaces, you need to weigh down your website with a multitude of different fonts. The opposite is the case.</p>

<p>In most situations, a couple of judiciously paired typefaces can work wonders for your design and have a lighter impact on website performance.</p>

<h3 id="providewebfontformatsbasedonbrowsersupport">#2 Provide web font formats based on browser support</h3>

<p>There are four main font formats:</p>

<ul>
<li><strong>True Type Font (TTF)</strong>, a common font format that's been around since the late 80s</li>
<li><strong>Web Open Font Format (WOFF)</strong>, a format developed in 2009 which is Open Type or True Type, only with compression and further metadata</li>
<li><strong>Web Open Font Format (WOFF2)</strong>, a better compressed format than WOFF</li>
<li><strong>Embedded Open Type (EOT)</strong>, a format designed by Microsoft to be used for embedded fonts on the web.</li>
</ul>

<p>Although you could specify all of them in your <code>@font-face</code> declaration, you can get away with just two of them. Here's how:</p>

[code language="css"]
@font-face {
  font-family: 'Open Sans';
  src: local('Open Sans'), local('OpenSans'),
       url('fonts/open-sans.woff2') format('woff2'),
       url('fonts/open-sans.woff') format('woff');
}
[/code]

<p>
The first format you suggest to the browser is woff2, which gives you the advantage of extra compression. If your browser doesn't support woff2, it just selects woff, which has good compression and enjoys <a href="http://caniuse.com/#search=woff">support by the latest versions of all major browsers</a>. Only Opera Mini lacks support for it, together with IE8 and older Android Mobile browsers. If you use a progressive enhancement approach to web development, you could simply let these older browsers fall back on a system font, e.g., Arial, Verdana, etc.</p>

<h3 id="loadjustthestylesyouneed">#3 Load just the styles you need</h3>

<p>Fonts usually have different variants --- italic, bold, etc. Each font variation adds weight to the file size, so try to avoid adding a font variation to your <code>@font-face</code> code if you're not going to use it on your website. Keep in mind that if you use an <code>&lt;i&gt;</code> tag to add an icon, which is quite common, that is enough to get the browser to load the italic font variant (<a href="https://speakerdeck.com/zachleat/the-performance-and-usability-of-font-loading-velocity-santa-clara-2015">Slide 77 in Zack Leatherman's Santa Clara Velocity talk of 2015</a>).  If that's the only instance of <code>&lt;i&gt;</code> in your page, using a <code>&lt;span&gt;</code> tag for the icon or setting the <code>font-style</code> for the <code>&lt;i&gt;</code> element to <code>normal</code> instead would spare the browser from having to download unnecessary resources.</p>

<h3 id="keepyourcharactersetsdown">#4 Keep your character sets down</h3>

<p>Avoid loading all the characters, numbers and symbols your chosen font makes available. Instead, select just the character sets you actually use on your webpage.</p>

<p>You can learn everything about fonts subsetting in <a href="http://thenewcode.com/878/Slash-Page-Load-Times-With-CSS-Font-Subsetting">Slash Page Load Times With CSS Font Subsetting</a>, by Dudley Storey.</p>

<h2 id="tacklingfoit">Tackling FOIT</h2>

<p>Let's look at some alternatives available today for dealing with FOIT. I've singled out the simplest approaches to implement among effective and recommended practices. However, you can learn about far more sophisticated ones in Zach Leatherman's <a href="https://www.zachleat.com/web/comprehensive-webfonts/">A Comprehensive Guide to Font Loading Strategies</a>.</p>

<h3 id="donotusecustomfonts">Don't use custom fonts</h3>

<p>If you can't stand the idea of your users staring at invisible text or at font-swapping shifts, the most simple option is to give up on custom fonts and rely solely on web-safe fonts.</p>

<p>These fonts are preinstalled on users' devices, so the browser doesn't need to load them. Even when deciding to use custom fonts, web safe-fonts are commonly added to the <a href="http://www.cssfontstack.com/">font stack</a> as a fallback.</p>

<p>Giving up on the perfect custom font for your design is not an exciting approach, but it's perfectly viable --- especially if you consider this as a transitory stance until cutting edge solutions, which are already on the horizon, gain wide browser support.</p>

<p>Opting for this approach doesn't require you to use <code>@font-face</code>. You just add your font stack to the CSS <code>font-family</code> property. Here's how you could do this today:</p>

[code language="css"]
body {
  font-family: -apple-system,
    BlinkMacSystemFont,
    "Segoe UI",
    Roboto,
    Oxygen-Sans,
    Ubuntu,
    Cantarell,
    "Helvetica Neue",
    sans-serif;
}

[/code]

<p><a href="https://bitsofco.de/the-new-system-font-stack/">The New System Font Stack?</a>’, by Aderinokun, provides more information on the modern font stack.</p>

<h3 id="thewebfontloader">The Web Font Loader</h3>

<p>One long-standing solution is the <a href="https://github.com/typekit/webfontloader">Web Font Loader</a>, a JavaScript library developed by Google and <a href="https://typekit.com/">Typekit</a>, which works with fonts coming from multiple sources --- such as Google Fonts, Typekit, your self-hosted font files, etc.</p>

<p>The Web Font Loader loads custom fonts as a background process while displaying fallback fonts to users, thereby avoiding FOIT. You can set a time limit of your choice within which the font must load. If the request exceeds this limit, users will only see the text styled with a fallback font. Once the custom font is loaded, the script swaps the fallback font on the page with the custom font.</p>

<p>Here are two awesome tutorials to learn how to use the Web Font Loader:
</p>

<ul>
<li><a href="https://www.sitepoint.com/improve-page-performance-font-loader/">How to Improve Page Performance with a Font Loader</a></li>
<li><a href="https://css-tricks.com/loading-web-fonts-with-the-web-font-loader/">Loading Web Fonts with the Web Font Loader</a></li>
</ul>

<h3 id="thecssfontloadingapi">The CSS Font Loading API</h3>

<p>The <a href="https://drafts.csswg.org/css-font-loading/">CSS Font Loading API</a> is a standards-based way of loading and taking control of web fonts.
</p>

<p>The overall recommended approach remains that of avoiding FOIT and managing FOUT as best as possible. This API can keep track of every stage of font loading. You can use this information to style text using web-safe fonts while fonts are not available and style text using custom fonts once these are fully loaded.</p>

<p>At the time of writing, the latest versions of <a href="http://caniuse.com/#search=css%20font%20loading">Chrome, Firefox, Safari and Opera support this API</a>, while IE/Edge doesn't offer support yet. However, you can use a small JavaScript library, the <a href="https://github.com/bramstein/fontfaceobserver">Font Face Observer</a>, to polyfill the native CSS Font Loading API, or simply let non-supporting browsers degrade gracefully to web-safe fonts.</p>

<p>For a short tutorial on how to use the CSS Font Loading API, head over to <a href="https://medium.com/@matuzo/getting-started-with-css-font-loading-e24e7ffaa791">Getting started with CSS Font Loading</a> by Manuel Matuzovic and have a look at his <a href="http://codepen.io/matuzo/pen/jrzyYA?editors=0011">CodePen demo</a>.</p>

<h2 id="thefuturethecssfontdisplayproperty">The Future: The CSS <code>font-display</code> Property</h2>

<p>Since their first appearance, you've handled custom fonts using CSS <code>@font-face</code> and <code>font-family</code>. It's only fair to expect CSS to solve any issue related to downloading custom fonts. But at present, only JavaScript-based solutions are usable.</p>

<p>However, this won't be so indefinitely. A smart CSS property is around the corner, <code>font-display</code>, which is part of the <a href="https://tabatkins.github.io/specs/css-font-display/">CSS Font Rendering Controls Module Level 1</a>.</p>

<p><code>font-display</code> lets you:</p>

<ul>
<li>Decide if you want to show text using a fallback font or hide it while the font is loading.</li>
<li>Control what you want to do once the font has loaded, i.e., continue to show the fallback font or replace it with the custom font. You can also do so on a per-element basis.</li>
<li>Specify your own timeout values for each font and even for a specific element.</li>
</ul>

<p>Here's what this property looks like in code:</p>

[code language="css"]
@font-face {
  font-family: Lato;
  src: url('/web/css/fonts/lato/lato-regular-webfont.woff2') format('woff2'),
  url('/web/css/fonts/lato/lato-regular-webfont.woff') format('woff');
  font-weight: 400;
  font-style: normal;

  /* This value replaces fallback when font has loaded */
  font-display: swap;
}

body {
  font-family: Lato, sans-serif;
  font-weight: 400;
  font-style: normal;
}
[/code]

<p>Accepted values for this property are:</p>

<ul>
<li><strong>auto</strong>: browsers just implement their default behavior.</li>
<li><strong>block</strong>: browsers draw invisible text while the font is loading and replace it with the desired font as soon as it's loaded.</li>
<li><strong>swap</strong>: browsers use a fallback font while the custom font isn't available, but swap the custom font in as soon as it loads.</li>
<li><strong>fallback</strong>: similar behavior to <code>swap</code>. However, if too much time passes until the custom font loads, browsers use the fallback font for the duration of the page's lifetime.</li>
<li><strong>optional</strong>: this super smart value lets browsers use the custom font only if it's already available. If it isn't, browsers use the fallback for the duration of the page's lifetime. The custom font may still be downloaded in the background for use on subsequent page loads. However, if browsers detect limited bandwidth on users' devices, they might not load the custom font at all.</li>
</ul>

<p>From these short descriptions, you can already see how <code>swap</code> and <code>optional</code> could be super useful.</p>

<p><a href="http://caniuse.com/#search=font-display">Browser support</a> for <code>font-display</code> is non-existent at this time, but it can be enabled in Chrome (via the Experimental Web Platform features" flag) and Firefox (via the <code>layout.css.font-display.enabled</code> flag).</p>

<h2 id="whataboutfout">What About FOUT?</h2>

<p>Although all the approaches outlined above make possible the elimination of FOIT, either by swapping in the custom font at a later time or by displaying just the fallback font, they can do little against FOUT.</p>

<p>Although FOUT makes text still available to users, it can very well be annoying, especially when the fallback font is wider and/or higher than the custom font it is temporarily replacing, which often causes a shift in the page content.</p>

<p>You can mitigate the jarring effect of the swap by adjusting the fallback font's <a href="https://www.fonts.com/content/learning/fontology/level-1/type-anatomy/x-height">x-height</a> and width so as to match the desired custom font's x-height and width as closely as possible.</p>

<p>You can do this in a number of ways, but I find this little <a href="https://meowni.ca/font-style-matcher/">Font Style Matcher tool</a> by Monica Dinculescu really helpful.</p>


<h2 id="conclusion">Conclusion</h2>

<p>In this article I've outlined the issues of file size and Flash of Invisible Text related to using custom fonts on websites.</p>

<p>I've presented the latest approaches and pointed you to further resources where you can read more and learn how to implement those techniques in your projects.</p>
